---
layout: post
title: Linux 프로세스
feature-img: "assets/img/posts/linux.png"
thumbnail: "assets/img/posts/linux.png"
tags: [Linux]
---

리눅스의 프로세스를 식별하는 PID와 PPID에 대해서 알아보고, 잘못된 프로세스의 종료 시의 현상과 프로세스를 강제로 종료하는 kill 명령어에 대해서도 알아본다.

## 1. Process와 PID

리눅스에서 프로세스는 `PID`(process ID)라는 식별 번호가 붙는다. 여기서 프로세스는 실행 중인 프로그램을 의미하는데, 메모리에 적재되어 있으며, 프로세스의 상태정보, PCB를 포함한 개념이다. PID의 할당 방식은 최근 할당된 PID에 1을 더한 값으로 할당된다.

`PPID`(Parent Process ID)는 부모 프로세스의 PID를 말하며, 모든 프로세스는 부모 프로세스를 가진다. 부모 프로세스는 현재 실행 중인 프로세스(자식 프로세스) 를 시스템 콜을 호출하여 생성시킨 프로세스를 의미한다.

이러한 PID, PPID를 확인하기 위하여 다음의 명령을 사용하여 현재 실행 중인 모든 프로세스의 PID, PPID를 확인할 수 있다.

```bash
ps -ef
```

## 2. 잘못된 프로세스의 종료

### 2.1 좀비(zombi) 프로세스

프로세스가 종료되고 리소스는 모두 회수되었지만, 시스템 프로세스 테이블에 남아있는 `defunct` 상태의 프로세스를 `좀비 프로세스(zombie process)`라고 한다. 실행이 종료되었지만 아직 삭제되지 않은 프로세스라고 볼 수 있다.

> 프로세스는 `exit()` 시스템 함수를 호출함으로써 운영체제에게 자신의 삭제를 요청하며 종료된다. 그리고 프로세스가 사용하던 리소스를 OS가 회수한다. 이때 프로세스의 종료 상태가 저장되는 시스템 프로세스 테이블에는 해당 프로세스가 남아있는 상태가 되며, 해당 프로세스는 부모 프로세스가 `wait()` 시스템 함수를 호출할 때까지 남아있게 되는데, 이 상태가 좀비 프로세스인 것이다.

이 좀비 프로세스는 이미 리소스를 반환한 상태이기 때문에 시스템 리소스를 소모하지는 않으나, PID를 할당받은 상태이기 때문에 새로운 프로세스의 실행을 방해하는 문제가 발생할 수 있다. 이러한 이유 때문에 좀비 프로세스에 대한 관리가 필요하다.

그러나 이러한 좀비 프로세스는 이미 리소스 반환 및 기타 프로세스 종료 과정이 끝났기 때문에 `kill` 명령어를 사용하여 강제 종료하더라도 종료되지 않는다. 부모 프로세스 자체를 죽여야만 이러한 좀비 프로세스도 모두 종료시킬 수 있다.

다음의 명령으로 좀비 프로세스를 찾을 수 있다.

```bash
ps -ef | grep defunct | grep -v grep
```

그리고 top 명령 시 다음의 명령을 이용하여 좀비 프로세스의 갯수를 간단하게 파악할 수 있다.

```bash
top -b -n 1 | grep zombie
```

### 2.2 고아(orphan) 프로세스

고아 프로세스란 부모 프로세스가 종료되었지만 자식 프로세스가 종료되지 않은 상태를 말한다. 일반적으로 부모 프로세스는 자식 프로세스를 생성하고 자식 프로세스가 종료되기를 기다린다. 그러나 부모 프로세스가 비정상적으로 종료되면 자식 프로세스는 부모 프로세스가 종료되어도 독립적으로 실행되는데, 이 경우 자식 프로세스는 더 이상 부모 프로세스가 없으므로 고아 프로세스가 된다.

고아 프로세스는 여러 가지 문제를 발생시킬 수 있다. 먼저, 고아 프로세스는 시스템의 자원을 낭비할 수 있다. 이는 메모리, 프로세서 시간 및 파일 디스크립터 등을 포함한다. 또한, 고아 프로세스는 더 이상 부모 프로세스에게 종속되지 않으므로 부모 프로세스에서 해당 프로세스를 제어하거나 모니터링할 수 없게 되는데, 이러한 문제를 방지하기 위해 부모를 `Init` 프로세스로 묶어준다. 즉, 고아의 PPID는 1이 되고, 고아는 Init 프로세스의 양자가 된다. 고아 프로세스가 양자가 되면 정상종료가 가능해진다.

## 3. kill

프로세스를 강제 종료시킬 때 `kill` 명령을 통해 프로세스를 강재 종료할 수 있다.

```bash
kill [option] [PID]
```

또는 다음과 같이 `pkill` 명령어를 사용할 수 있는데, pkill 명령어는 PATTERN의 정규표현식에 해당하는 모든 프로세스를 중지시킨다.

```bash
pkill [option] [PATTERN]
 ```

여기서 주로 사용되는 kill 명령어의 option은 다음과 같다.

* `-1` (or `-SIGHUP`): 로그아웃등의 접속이 끊을 때 발생하는 신호(Signal)로 특정 실행 중인 프로그램이 사용하는 설정 파일을 변경시키고 변화된 내용을 적용할때 사용된다.
* `-2` (or `-SIGINT`): 현재 작동중인 프로그램의 동작을 멈출때 사용되며, 일반적인 값은 `<CTRL>+<c>` 이다.
* `-9` (or `-SIGKILL`): 프로그램을 무조건 종료할 경우 사용된다.
* `-11` (or `-SIGSEGV`): 잘못된 메모리 관리시 생기는 신호(Signal)이다.
* `-15` (or `-SIGTERM`): 실행중인 프로그램을 정상적인 종료방법으로 프로그램을 종료하는 신호(Signal)로 kill 명령에서 신호(Signal)를 지정하지 않으면 이 신호(Signal)를 사용하여 프로그램을 종료한다.
* `-18` (or `-SIGCONT`): 중지 되어 있는 프로그램을 재실행 하는데 사용되는 신호(Signal)이다.
* `-19` (or `-SIGSTOP`): 프로그램을 중지 하는데 사용되는 신호(Signal)이다.
* `-20` (or `-SIGTSTP`): 터미널에서 중지되어 있는 신호(Signal)이다.

## 참고문헌

* [좀비 프로세스 원인과 죽이는 방법(Zombie Process)](https://wildeveloperetrain.tistory.com/180)
* [[Linux] PID, PPID](https://jammdev.tistory.com/m/140)
* [Linux - PID, PPID, PGID, SID란?](https://leeyh0216.github.io/posts/sid_pid_ppid_pgid/)
* [프로세스의 잘못된 종료상태 실습(zombie, orphan)](https://lagifun-inforecord.tistory.com/29)
* [Linux - kill 명령어 알아보기(프로세스 제어)](https://server-talk.tistory.com/432)
* [[Ubuntu] 프로세스 강제 종료시키기](https://eunji-study.tistory.com/m/14)